{"version":3,"sources":["../../../source/library/special/babel.js"],"names":["FileSystem","Is","JSON5","Match","Path","Query","GetDependencyName","Babel","filePath","packageDependency","fileDependency","fileName","basename","pattern","reduce","isMatch","configuration","parse","readFile","babel","plugin","query","filter","array","map","preset","dependency","endsWith"],"mappings":"AAAA,OAAOA,UAAP,MAAuB,UAAvB;AACA,OAAOC,EAAP,MAAe,SAAf;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,WAAlB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,KAAP,MAAkB,UAAlB;;AAEA,SAASC,iBAAT,QAAkC,2BAAlC;;AAEA,OAAO,eAAeC,KAAf,CAAqBC,QAArB,EAA+BC,iBAA/B,EAAkD;AACvD;AACA;;AAEA,MAAIC,cAAc,GAAG,EAArB;;AAEA,MAAIC,QAAQ,GAAGP,IAAI,CAACQ,QAAL,CAAcJ,QAAd,CAAf;AACA,MAAIK,OAAO,GAAG,CAAE,cAAF,EAAkB,mBAAlB,EAAuC,eAAvC,CAAd;;AAEA,MAAIA,OAAO,CAACC,MAAR,CAAe,CAACC,OAAD,EAAUF,OAAV,KAAsBE,OAAO,GAAGA,OAAH,GAAaZ,KAAK,CAACQ,QAAD,EAAWE,OAAX,EAAoB,EAAE,OAAO,IAAT,EAApB,CAA9D,EAAoG,KAApG,CAAJ,EAAgH;;AAE9G,QAAIG,aAAa,GAAG,IAApB;AACAA,IAAAA,aAAa,GAAGd,KAAK,CAACe,KAAN,CAAY,MAAMjB,UAAU,CAACkB,QAAX,CAAoBV,QAApB,EAA8B,EAAE,YAAY,OAAd,EAA9B,CAAlB,CAAhB;AACAQ,IAAAA,aAAa,GAAGL,QAAQ,KAAK,cAAb,GAA+BK,aAAa,CAACG,KAAd,IAAuB,EAAtD,GAA4DH,aAA5E;;AAEA,QAAII,MAAM,GAAG,IAAb;AACAA,IAAAA,MAAM,GAAGf,KAAK,CAACgB,KAAN,CAAYL,aAAZ,EAA2B,eAA3B,CAAT;AACAI,IAAAA,MAAM,GAAGA,MAAM,CAACE,MAAP,CAAeF,MAAD,IAAYnB,EAAE,CAACsB,KAAH,CAASH,MAAT,KAAoBA,MAAM,KAAK,YAAzD,CAAT;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAACI,GAAP,CAAYJ,MAAD,IAAYnB,EAAE,CAACsB,KAAH,CAASH,MAAT,IAAmBA,MAAM,CAAC,CAAD,CAAzB,GAA+BA,MAAtD,CAAT;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAACI,GAAP,CAAYJ,MAAD,IAAYd,iBAAiB,CAACc,MAAD,CAAxC,CAAT;;AAEA,QAAIK,MAAM,GAAG,IAAb;AACAA,IAAAA,MAAM,GAAGpB,KAAK,CAACgB,KAAN,CAAYL,aAAZ,EAA2B,eAA3B,CAAT;AACAS,IAAAA,MAAM,GAAGA,MAAM,CAACD,GAAP,CAAYC,MAAD,IAAYxB,EAAE,CAACsB,KAAH,CAASE,MAAT,IAAmBA,MAAM,CAAC,CAAD,CAAzB,GAA+BA,MAAtD,CAAT;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAACD,GAAP,CAAYC,MAAD,IAAYnB,iBAAiB,CAACmB,MAAD,CAAxC,CAAT;;AAEAf,IAAAA,cAAc,GAAG,CAAC,GAAGU,MAAJ,EAAY,GAAGK,MAAf;AACdD,IAAAA,GADc,CACTE,UAAD,IAAgBjB,iBAAiB;AACnCa,IAAAA,MADkB,CACVb,iBAAD,IAAuBA,iBAAiB,CAACkB,QAAlB,CAA2BD,UAA3B,CADZ;AAElBZ,IAAAA,MAFkB,CAEX,CAACY,UAAD,EAAajB,iBAAb,KAAmCA,iBAFxB,EAE2CiB,UAF3C,CADN,CAAjB;;AAKD;;AAED;AACA,SAAOhB,cAAP;;AAED","sourcesContent":["import FileSystem from 'fs-extra'\nimport Is from '@pwn/is'\nimport JSON5 from 'json5'\nimport Match from 'minimatch'\nimport Path from 'path'\nimport Query from 'jsonpath'\n\nimport { GetDependencyName } from '../get-dependency-name.js'\n\nexport async function Babel(filePath, packageDependency) {\n  // console.log(`Babel('${Path.relative('', filePath)}', packageDependency) { ... }`)\n  // console.dir(packageDependency)\n\n  let fileDependency = []\n\n  let fileName = Path.basename(filePath)\n  let pattern = [ 'package.json', 'babel.config.json', '.babelrc.json' ]\n\n  if (pattern.reduce((isMatch, pattern) => isMatch ? isMatch : Match(fileName, pattern, { 'dot': true }), false)) {\n\n    let configuration = null\n    configuration = JSON5.parse(await FileSystem.readFile(filePath, { 'encoding': 'utf-8' }))\n    configuration = fileName === 'package.json' ? (configuration.babel || {}) : configuration\n\n    let plugin = null\n    plugin = Query.query(configuration, '$..plugins[*]')\n    plugin = plugin.filter((plugin) => Is.array(plugin) || plugin !== 'importMeta')\n    plugin = plugin.map((plugin) => Is.array(plugin) ? plugin[0] : plugin)\n    plugin = plugin.map((plugin) => GetDependencyName(plugin))\n\n    let preset = null\n    preset = Query.query(configuration, '$..presets[*]')\n    preset = preset.map((preset) => Is.array(preset) ? preset[0] : preset)\n    preset = preset.map((preset) => GetDependencyName(preset))\n    \n    fileDependency = [...plugin, ...preset]\n      .map((dependency) => packageDependency\n        .filter((packageDependency) => packageDependency.endsWith(dependency))\n        .reduce((dependency, packageDependency) => packageDependency, dependency))\n\n  }\n\n  // console.dir(fileDependency)\n  return fileDependency\n\n}"],"file":"babel.js"}