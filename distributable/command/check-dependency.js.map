{"version":3,"sources":["../../source/command/check-dependency.js"],"names":["createRequire","CreateRequire","Command","FileSystem","Is","JSON5","Path","Check","Process","process","Require","import","meta","url","Package","parse","readFileSync","resolve","version","option","cwd","action","path","projectPath","configuration","pathExists","configurationPath","readFile","dependency","not","emptyObject","missing","missingDependency","Object","entries","sort","leftDependency","rightDependency","localeCompare","console","log","repeat","forEach","map","relative","join","exitCode","unused","length","used","reportUsed","usedDependency","error","argv"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\nimport '@virtualpatterns/mablung-source-map-support/install'\nimport { createRequire as CreateRequire } from 'module'\nimport Command from 'commander'\nimport FileSystem from 'fs-extra'\nimport Is from '@pwn/is'\nimport JSON5 from 'json5'\nimport Path from 'path'\n\nimport { Check } from '../library/check.js'\n\nconst Process = process\nconst Require = CreateRequire(import.meta.url)\n\nconst Package = JSON5.parse(FileSystem.readFileSync(Require.resolve('../../package.json')), { 'encoding': 'utf-8' })\n\nCommand\n  .version(Package.version)\n  .option('--project-path <path>', 'Path of the project to check', Process.cwd())\n  .option('--configuration-path <path>', 'Path of the configuration file, if it exists', `${Process.cwd()}/check-dependency.json`)\n  .option('--report-used', 'Report used dependencies')\n  .action(async (option) => {\n\n    try {\n\n      let path = option.projectPath\n      let configuration = null\n\n      if (await FileSystem.pathExists(option.configurationPath)) {\n        configuration = JSON5.parse(await FileSystem.readFile(option.configurationPath, { 'encoding': 'utf-8' }))\n      } else {\n        configuration = {}\n      }\n\n      let dependency = await Check(path, configuration)\n      \n      if (Is.not.emptyObject(dependency.missing)) {\n\n        let missingDependency = null\n        missingDependency = Object.entries(dependency.missing)\n        missingDependency = missingDependency.sort(([leftDependency], [rightDependency]) => leftDependency.localeCompare(rightDependency))\n\n        console.log('-'.repeat(80))\n        console.log('Missing dependencies')\n        console.log('-'.repeat(80))\n\n        missingDependency.forEach(([dependency, path]) => {\n          console.log(`${dependency} used in ...`)\n          console.log(path.sort().map((path) => `  ${Path.relative('', path)}`).join('\\n'))\n        })\n\n        console.log()\n\n        process.exitCode = 1\n\n      }\n      \n      if (dependency.unused.length > 0) {\n\n        console.log('-'.repeat(80))\n        console.log('Unused dependencies')\n        console.log('-'.repeat(80))\n        console.log(dependency.unused.sort().map((dependency) => `${dependency}`).join('\\n'))\n        console.log()\n\n        process.exitCode = 1\n\n      }\n\n      if (Is.not.emptyObject(dependency.used) &&\n          option.reportUsed) {\n\n        let usedDependency = null\n        usedDependency = Object.entries(dependency.used)\n        usedDependency = usedDependency.sort(([leftDependency], [rightDependency]) => leftDependency.localeCompare(rightDependency))\n    \n        console.log('-'.repeat(80))\n        console.log('Used dependencies')\n        console.log('-'.repeat(80))\n\n        usedDependency.forEach(([dependency, path]) => {\n          console.log(`${dependency} used in ...`)\n          console.log(path.sort().map((path) => `  ${Path.relative('', path)}`).join('\\n'))\n        })\n\n        console.log()\n\n      }\n\n      if (Is.emptyObject(dependency.missing) &&\n          dependency.unused.length <= 0) {\n        \n        console.log('-'.repeat(80))\n        console.log('There are no dependency issues.')\n        console.log('-'.repeat(80))\n\n        process.exitCode = 0\n\n      }\n      \n    } catch (error) {\n      console.error(error)\n      process.exitCode = 2\n    }\n\n  })\n\nCommand.parse(Process.argv)\n"],"file":"check-dependency.js"}