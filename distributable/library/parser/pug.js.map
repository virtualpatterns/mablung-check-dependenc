{"version":3,"sources":["../../../source/library/parser/pug.js"],"names":["FileSystem","Query","Lex","Load","Parse","GetDependencyName","Pug","filePath","packageDependency","fileDependency","content","readFile","token","ast","node","query","dependency","map","name","filter","endsWith","reduce"],"mappings":"AAAA,OAAOA,UAAP,MAAuB,UAAvB;AACA;AACA,OAAOC,KAAP,MAAkB,UAAlB;;AAEA,OAAOC,GAAP,MAAgB,WAAhB;AACA,OAAOC,IAAP,MAAiB,UAAjB;AACA,OAAOC,KAAP,MAAkB,YAAlB;;AAEA,SAASC,iBAAT,QAAkC,2BAAlC;;AAEA,OAAO,eAAeC,GAAf,CAAmBC,QAAnB,EAA6BC,iBAA7B,EAAgD;AACrD;AACA;;AAEA,MAAIC,cAAc,GAAG,EAArB;;AAEA,MAAIC,OAAO,GAAG,MAAMV,UAAU,CAACW,QAAX,CAAoBJ,QAApB,EAA8B,EAAE,YAAY,OAAd,EAA9B,CAApB;AACA,MAAIK,KAAK,GAAG,IAAZ;AACA,MAAIC,GAAG,GAAG,IAAV;;AAEAD,EAAAA,KAAK,GAAGV,GAAG,CAACQ,OAAD,EAAU,EAAE,YAAYH,QAAd,EAAV,CAAX;AACAM,EAAAA,GAAG,GAAGT,KAAK,CAACQ,KAAD,EAAQ,EAAE,YAAYL,QAAd,EAAR,CAAX;AACAM,EAAAA,GAAG,GAAGV,IAAI,CAACU,GAAD,EAAM,EAAE,OAAOX,GAAT,EAAc,SAASE,KAAvB,EAAN,CAAV;;AAEA;;AAEA,MAAIU,IAAI,GAAGb,KAAK,CAACc,KAAN,CAAYF,GAAZ,EAAiB,0DAAjB,CAAX;AACA,MAAIG,UAAU,GAAGF,IAAI,CAACG,GAAL,CAAUH,IAAD,IAAUT,iBAAiB,CAACS,IAAI,CAACI,IAAN,CAApC,CAAjB;;AAEAT,EAAAA,cAAc,GAAGO,UAAU;AACxBC,EAAAA,GADc,CACTD,UAAD,IAAgBR,iBAAiB;AACnCW,EAAAA,MADkB,CACVX,iBAAD,IAAuBA,iBAAiB,CAACY,QAAlB,CAA2BJ,UAA3B,CADZ;AAElBK,EAAAA,MAFkB,CAEX,CAACL,UAAD,EAAaR,iBAAb,KAAmCA,iBAFxB,EAE2CQ,UAF3C,CADN,CAAjB;;AAKA,SAAOP,cAAP;;AAED","sourcesContent":["import FileSystem from 'fs-extra'\n// import Path from 'path'\nimport Query from 'jsonpath'\n\nimport Lex from 'pug-lexer'\nimport Load from 'pug-load'\nimport Parse from 'pug-parser'\n\nimport { GetDependencyName } from '../get-dependency-name.js'\n\nexport async function Pug(filePath, packageDependency) {\n  // console.log(`Pug('${Path.relative('', filePath)}', packageDependency) { ... }`)\n  // console.dir(packageDependency)\n\n  let fileDependency = []\n\n  let content = await FileSystem.readFile(filePath, { 'encoding': 'utf-8' })\n  let token = null\n  let ast = null\n\n  token = Lex(content, { 'filename': filePath })\n  ast = Parse(token, { 'filename': filePath })\n  ast = Load(ast, { 'lex': Lex, 'parse': Parse })\n\n  // console.dir(ast, { 'depth': null })\n\n  let node = Query.query(ast, '$..*[?(@.type==\\'Filter\\' || @.type==\\'IncludeFilter\\')]')\n  let dependency = node.map((node) => GetDependencyName(node.name))\n  \n  fileDependency = dependency\n    .map((dependency) => packageDependency\n      .filter((packageDependency) => packageDependency.endsWith(dependency))\n      .reduce((dependency, packageDependency) => packageDependency, dependency))\n\n  return fileDependency\n\n}"],"file":"pug.js"}